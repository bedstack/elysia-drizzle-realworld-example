---
title: Database & ORM
description: Managing your database with Drizzle ORM in Bedstack.
---

Bedstack uses **[Drizzle ORM](https://orm.drizzle.team/)** for typesafe database access. Drizzle is a lightweight and performant ORM that feels like writing SQL but with full TypeScript support.

## Schema Definition

Database schemas are defined in `*.schema.ts` files. For example, `apps/conduit/src/users/users.schema.ts`:

```typescript
import { pgTable, serial, text, timestamp } from 'drizzle-orm/pg-core';

export const users = pgTable('users', {
  id: serial('id').primaryKey().notNull(),
  email: text('email').notNull().unique(),
  username: text('username').notNull().unique(),
  password: text('password').notNull(),
  bio: text('bio'),
  image: text('image'),
  createdAt: timestamp('created_at').defaultNow().notNull(),
});
```

## Database Instance

The database instance is configured in `apps/conduit/src/core/database.ts`. It uses the `postgres` driver for high performance.

```typescript
import { drizzle } from 'drizzle-orm/postgres-js';
import postgres from 'postgres';
import * as schema from './schema';

const client = postgres(process.env.DATABASE_URL!);
export const db = drizzle(client, { schema });
```

## Common Operations

### Select

```typescript
import { db } from '@/database';
import { users } from './users.schema';
import { eq } from 'drizzle-orm';

const user = await db.query.users.findFirst({
  where: eq(users.email, 'user@example.com'),
});
```

### Insert

```typescript
await db.insert(users).values({
  email: 'new@example.com',
  username: 'newuser',
  password: hashedPassword,
});
```

## Migrations

Bedstack uses `drizzle-kit` for managing migrations.

- **Generate migrations**: `bun run db:generate` (inside `apps/conduit`)
- **Push changes directly**: `bun run db:push` (useful for development)
- **Studio**: `bun run db:studio` (GUI to explore your database)

Migrations are stored in the `apps/conduit/drizzle` directory.
