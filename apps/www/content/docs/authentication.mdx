---
title: Authentication
description: How authentication works in Bedstack.
---

Bedstack implements authentication using **JWT (JSON Web Tokens)** and the `jose` library.

## Overview

Authentication is handled primarily in the `apps/conduit/src/auth` feature.

- **Tokens**: JWTs are signed using a secret key and contain user identification.
- **Header**: Clients should send the token in the `Authorization` header using the format `Token <jwt>`.
- **Services**: The `AuthService` provides methods for generating and verifying tokens.

## Using Authentication in Routes

To protect a route, you can use the `requireLogin` middleware from `AuthService`.

```typescript
import { Elysia } from 'elysia';
import { AuthService } from '@/auth/auth.service';

const authService = new AuthService();

export const articlesController = new Elysia({ prefix: '/articles' })
  .post('/', async ({ body, headers }) => {
    const userId = await authService.getUserIdFromHeader(headers);
    // Create article for user...
  }, {
    beforeHandle: [authService.requireLogin]
  });
```

## AuthService Methods

The `AuthService` includes several helper methods:

- `generateToken(user)`: Creates a new JWT for a user.
- `verifyToken(token)`: Validates a JWT and returns the payload.
- `getUserIdFromHeader(headers)`: Extracts and verifies the user ID from the Authorization header.
- `requireLogin`: A middleware that throws an `UNAUTHORIZED` error if the token is missing or invalid.

## Schema Validation

Tokens are validated against a schema to ensure they contain the expected fields:

```typescript
// From apps/conduit/src/auth/auth.service.ts
get VerifiedJwtSchema() {
  return Type.Object({
    payload: Type.Object({
      user: Type.Object({
        id: Type.Number(),
        email: Type.String(),
        username: Type.String(),
      }),
      // ...
    }),
  });
}
```
